<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd">
    <!-- IMPORTANT: this is the full script, add your changes inside in the right section -->


    <property name="now" value="CURRENT_TIMESTAMP()" dbms="h2"/>
    <property name="current_db_user" value="USER()" dbms="h2"/>


    <changeSet dbms="h2" author="sks" id="changelog-3.2-delta-1_h2_extension">
        <comment>create sequence</comment>
        <createSequence sequenceName="HIBERNATE_SEQUENCE" minValue="1"
                        incrementBy="1" startValue="1" cacheSize="100" cycle="false" ordered="false"/>
    </changeSet>

    <include file="/db/changelog.xml"  />
    <include file="/db/changelog-data.xml" />


<!--    <changeSet id="EDELIVERY-3361-1" author="CatalinEnache" dbms="h2">-->
<!--        <comment>create UI Replication view</comment>-->
<!--        <createView-->
<!--                replaceIfExists="true"-->
<!--                viewName="V_MESSAGE_UI_DIFF">-->
<!--            SELECT-->
<!--                message_id,-->
<!--                message_status,-->
<!--                notification_status,-->
<!--                msh_role,-->
<!--                message_type,-->
<!--                deleted,-->
<!--                received,-->
<!--                send_attempts,-->
<!--                send_attempts_max,-->
<!--                next_attempt,-->
<!--                conversation_id,-->
<!--                from_id,-->
<!--                to_id,-->
<!--                from_scheme,-->
<!--                to_scheme,-->
<!--                ref_to_message_id,-->
<!--                failed,-->
<!--                restored,-->
<!--                message_subtype-->
<!--            FROM-->
<!--                (-->
<!--                    SELECT-->
<!--                        message_log.message_id,-->
<!--                        message_log.message_status,-->
<!--                        message_log.notification_status,-->
<!--                        message_log.msh_role,-->
<!--                        message_log.message_type,-->
<!--                        message_log.deleted,-->
<!--                        message_log.received,-->
<!--                        message_log.send_attempts,-->
<!--                        message_log.send_attempts_max,-->
<!--                        message_log.next_attempt,-->
<!--                        user_message.coll_info_convers_id AS conversation_id,-->
<!--                        partyid5_.value AS from_id,-->
<!--                        partyid6_.value AS to_id,-->
<!--                        property.value AS from_scheme,-->
<!--                        property2.value AS to_scheme,-->
<!--                        message_info.ref_to_message_id,-->
<!--                        message_log.failed,-->
<!--                        message_log.restored,-->
<!--                        message_log.message_subtype-->
<!--                    FROM-->
<!--                        tb_message_log message_log-->
<!--                            LEFT OUTER JOIN tb_message_info message_info ON message_log.message_id =-->
<!--                                                                            message_info.message_id,tb_user_message user_message-->
<!--                                                                                                        LEFT OUTER JOIN tb_property property ON user_message.id_pk = property.messageproperties_id-->
<!--                                                                                                        LEFT OUTER JOIN tb_property property2 ON user_message.id_pk = property2.messageproperties_id-->
<!--                                                                                                        LEFT OUTER JOIN tb_party_id partyid5_ ON user_message.id_pk = partyid5_.from_id-->
<!--                                                                                                        LEFT OUTER JOIN tb_party_id partyid6_ ON user_message.id_pk = partyid6_.to_id-->
<!--                    WHERE-->
<!--                        user_message.messageinfo_id_pk = message_info.id_pk-->
<!--                      AND property.name = 'originalSender'-->
<!--                      AND property2.name = 'finalRecipient'-->
<!--                    UNION-->
<!--                    SELECT-->
<!--                        message_log.message_id,-->
<!--                        message_log.message_status,-->
<!--                        message_log.notification_status,-->
<!--                        message_log.msh_role,-->
<!--                        message_log.message_type,-->
<!--                        message_log.deleted,-->
<!--                        message_log.received,-->
<!--                        message_log.send_attempts,-->
<!--                        message_log.send_attempts_max,-->
<!--                        message_log.next_attempt,-->
<!--                        '' AS conversation_id,-->
<!--                        partyid7_.value AS from_id,-->
<!--                        partyid8_.value AS to_id,-->
<!--                        property.value AS from_scheme,-->
<!--                        property2.value AS to_scheme,-->
<!--                        message_info.ref_to_message_id,-->
<!--                        message_log.failed,-->
<!--                        message_log.restored,-->
<!--                        message_log.message_subtype-->
<!--                    FROM-->
<!--                        tb_message_log message_log-->
<!--                            CROSS JOIN tb_messaging messaging-->
<!--                            INNER JOIN tb_signal_message signalmess2_ ON messaging.signal_message_id = signalmess2_.id_pk-->
<!--                            LEFT OUTER JOIN tb_message_info message_info ON signalmess2_.messageinfo_id_pk = message_info.id_pk-->
<!--                            INNER JOIN tb_user_message user_message ON messaging.user_message_id = user_message.id_pk-->
<!--                            LEFT OUTER JOIN tb_property property ON user_message.id_pk = property.messageproperties_id-->
<!--                            LEFT OUTER JOIN tb_property property2 ON user_message.id_pk = property2.messageproperties_id-->
<!--                            LEFT OUTER JOIN tb_party_id partyid7_ ON user_message.id_pk = partyid7_.from_id-->
<!--                            LEFT OUTER JOIN tb_party_id partyid8_ ON user_message.id_pk = partyid8_.to_id-->
<!--                            CROSS JOIN tb_message_info message_info2-->
<!--                    WHERE-->
<!--                        user_message.messageinfo_id_pk = message_info2.id_pk-->
<!--                      AND message_info.message_id = message_log.message_id-->
<!--                      AND message_info.ref_to_message_id = message_info2.message_id-->
<!--                      AND property.name = 'originalSender'-->
<!--                      AND property2.name = 'finalRecipient'-->
<!--                ) result WHERE result.received BETWEEN systimestamp - INTERVAL '48' HOUR AND systimestamp + INTERVAL '1'-->
<!--                HOUR-->
<!--            MINUS-->
<!--            SELECT-->
<!--                message_id,-->
<!--                message_status,-->
<!--                notification_status,-->
<!--                msh_role,-->
<!--                message_type,-->
<!--                deleted,-->
<!--                received,-->
<!--                send_attempts,-->
<!--                send_attempts_max,-->
<!--                next_attempt,-->
<!--                conversation_id,-->
<!--                from_id,-->
<!--                to_id,-->
<!--                from_scheme,-->
<!--                to_scheme,-->
<!--                ref_to_message_id,-->
<!--                failed,-->
<!--                restored,-->
<!--                message_subtype-->
<!--            FROM-->
<!--                TB_MESSAGE_UI WHERE-->
<!--                received BETWEEN systimestamp - INTERVAL '48' HOUR AND systimestamp + INTERVAL '1' HOUR-->
<!--        </createView>-->
<!--    </changeSet>-->


</databaseChangeLog>